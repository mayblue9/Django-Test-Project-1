<head>
	<!-- Javascript -->
	<script src="{{ STATIC_URL }}js/d3/d3.js" type='text/javascript'></script>
	<script src="{{ STATIC_URL }}js/d3/d3.layout.js" type='text/javascript'> </script>
	<script src="{{ STATIC_URL }}js/jquery-ui-1.8.17.custom/js/jquery-1.7.1.min.js" type='text/javascript'></script>	
	<script src="{{ STATIC_URL }}js/jquery-ui-1.8.17.custom/js/jquery-ui-1.8.17.custom.min.js" type='text/javascript'></script>
	<script>
	// Namespace protected functions
	$(function() {
		$( "#droppable" ).droppable({
			drop: function( event, ui ) {
				$( this )
					.addClass( "ui-state-highlight" )
					.find( "p" )
						.html( "Dropped!" );
			}
		});
		
		// These produce the same numbers
		$( "#droppable" ).bind( "drop", function(event, ui) {
			//var string = "Droppable Offset: top " + ui.offset.top + ", left " + ui.offset.left + ".";
			//alert(string);
			
		});
		// Tells the user if dragged into droppable
		// Bind all draggables in the container when created
		$('#cards_container').delegate( "div", "dragstop", function(event, ui) {
			var $droppable = $( "#droppable" );
			var noffset = $droppable.offset();
			var w = $droppable.width();
			var h = $droppable.height();
			
			var in_draggable = false;
			var w_rel = (ui.offset.left - noffset.left)/(w);
			var h_rel = (ui.offset.top - noffset.top)/(h);
			
			if( ui.offset.left > noffset.left && ui.offset.left < (noffset.left + w)){
				if( ui.offset.top > noffset.top && ui.offset.top < (noffset.top + h)){
					in_draggable = true;
				}
			}
			
			alert("w_r=" + w_rel + ", h_r=" + h_rel + ", inside="+ in_draggable);
		})
		
		
		
		$( ".draggable" ).bind( "dragstop", function(event, ui) {
			var $droppable = $( "#droppable" );
			var noffset = $droppable.offset();
			var w = $droppable.width();
			var h = $droppable.height();
			
			var in_draggable = false;
			var w_rel = (ui.offset.left - noffset.left)/(w);
			var h_rel = (ui.offset.top - noffset.top)/(h);
			
			if( ui.offset.left > noffset.left && ui.offset.left < (noffset.left + w)){
				if( ui.offset.top > noffset.top && ui.offset.top < (noffset.top + h)){
					in_draggable = true;
				}
			}
			
			alert("w_r=" + w_rel + ", h_r=" + h_rel + ", inside="+ in_draggable);
		});
	})
	
	// Functions to call once when doc ready
	$(document).ready(function(){
		// Create a new card with the form
		$("#name_input").submit(function(){
			var card = $('#new_card').val();
			console.log('card name: ' + card);
			$('<div class="ui-widget-content draggable">' + card + '</div>').prependTo($('#cards_container')).draggable();
			$(this).find(':text').val(''); // reset form to avoid duplicates
		})
	})
	</script>
	<!-- Styling -->
	<LINK href="{{ STATIC_URL }}js/jquery-ui-1.8.17.custom/css/le-frog/jquery-ui-1.8.17.custom.css" rel="stylesheet" type="text/css">
	<style>
	.draggable { width: 40px; height: 20px; padding: 0.5em; clear: both; margin: 10px 10px 10px 0; }
	#droppable { width: 500px; height: 300px; padding: 0.5em; float: left; margin: 10px 10px 10px 0;
		clear: both;
		border: 1px solid black;
	}
	.demo{
		width: 90%;
	}
	img {
		float: left;
	}
	.floatstop {
		clear: both;
	}
	</style>

</head>
<body>
	<h1>TEST PAGE</h1>

	<form id="name_input" action="javascript: var a=1;">
		New card: <input type="text" id="new_card" name="newcardname" /><br />
		<input type="submit" value="Submit" />
	</form>
	
	<div id="cards_container"></div>
	
	<div id="droppable">
		<p>Drop here</p>
	</div>
	
</body>